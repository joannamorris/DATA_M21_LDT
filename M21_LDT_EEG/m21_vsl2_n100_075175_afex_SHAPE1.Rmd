---
title: "M21 VSL2 dprime Sensitivity N100 (75-175 ms),  RAWSCORE SHAPE 1"
author: "Joanna Morris"
date: "`r Sys.Date()`"
output:
  bookdown::pdf_document2:
    number_sections: true
    toc: true
    toc_depth: 4
editor_options: 
  chunk_output_type: console
---

\scriptsize

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE, 
                      message = FALSE, 
                      error = FALSE,
                      comment = "||",
                      fig.height = 4,
                      fig.width = 4)
options(width = 130)
```

# Setup and load files {-}

Load libraries
```{r, echo=FALSE}
library(pander)
library(kableExtra)
library(afex)
library(gridExtra)
library(emmeans)
library(effectsize)
library(ggsci)
library(tidyverse)
library(RColorBrewer)
library(performance)
```


1. Set `ggplot2` parameters
```{r theme, echo = FALSE}
theme_set(theme_classic() +  
            theme(legend.position = "bottom", 
                  axis.text=element_text(size=10),
                  axis.title=element_text(size=9)))

# Define a custom color palette
my_palette <- c(  "#1F78B4","#E31A1C", "#33A02C")


# Create a function to apply this palette
scale_color_custom <- function() {
  scale_color_manual(values = my_palette)
}

scale_fill_custom <- function() {
  scale_fill_manual(values = my_palette)
}

```

2. Load the data files
```{r}
erpdat_1 <- read_csv("n1_erpdat_1_123.csv") 
erpdat_2 <- read_csv("n1_erpdat_2_123.csv")

erpdat_1_diff <- read_csv("n1_erpdat_1_123_fam_diff.csv")
erpdat_2_diff <- read_csv("n1_erpdat_2_123_fam_diff.csv")
```

Change the variables Sensitivity and Anteriority to factors to ensure that the levels show up in the right order

```{r}
erpdat_1 <- erpdat_1 |>
  filter(Shape == "First") |>
  mutate(
    Sensitivity = factor(Sensitivity, levels = c("Sensitive", "Insensitive")),
    Familiarity = factor(Familiarity, levels = c("Familiar", "Unfamiliar")),
    Accuracy    = factor(Accuracy, levels = c("Correct", "Incorrect")),
    Anteriority = factor(Anteriority, levels = c("Frontal", "Central", "Parietal")),
    Laterality  = factor(Laterality, levels = c("Left", "Midline", "Right"))  
        )

erpdat_2 <- erpdat_2 |>
  filter(Shape == "First") |>
  mutate(
    Sensitivity = factor(Sensitivity, levels = c("Sensitive", "Insensitive")),
    Familiarity = factor(Familiarity, levels = c("Familiar", "Unfamiliar")),
    Accuracy    = factor(Accuracy, levels = c("Correct", "Incorrect")),
    Anteriority = factor(Anteriority, levels = c("Frontal", "Central", "Parietal")),
    Laterality  = factor(Laterality, levels = c("Left", "Midline", "Right"))  
        )
```

# ANOVA  Group 1 

*Why This Approach is Correct*

- Proper error estimation: The model accounts for `Laterality`, `Anteriority`, and `Stimulus Position` as nuisance variables, preventing them from distorting estimates of `Sensitivity`, `Familiarity`, and `Accuracy.`

- Avoids sphericity issues: The mixed() function models within-subject dependencies appropriately.

- Corrects for multiple comparisons: Using Bonferroni adjustment prevents inflated Type I errors.

## ANOVA Model
```{r}
# Group 1

# Fit the ANOVA/mixed model
anova_model_1 <- mixed(
  value ~ Sensitivity * Familiarity * Accuracy + 
    Laterality * Anteriority  +  # Nuisance variables
    (1 | SubjID), 
  data = erpdat_1, 
  method = "KR"  # Kenward-Roger approximation for accurate F-tests
)

# Print ANOVA results
anova_model_1
```

### Compute Partial Eta Squared 

Compute Partial Eta Squared ($\eta_p^2$ ) for F-tests. This gives $\eta_p^2$  values for each effect.  Then, compute $R^2$ for the Mixed Model. This provides marginal $R^2$ (fixed effects only) and conditional $R^2$ (fixed + random effects).

```{r}
# Extract effect sizes from your ANOVA model
eta_squared(anova_model_1, partial = TRUE)

# Compute Marginal and Conditional R²
r2(anova_model_1)
```

### Main Findings: ANOVA

**Main Effects**

  - Sensitivity (between-subjects):  $F(1, 58) = 4.13, p <.047$

  - Familiarity (within-subjects):   $F(1, 2086) = 245.04, p <.001$

  - Accuracy (within-subjects):      $F(1, 2086) = 10.64, p = .001$

**Interactions**

  - Sensitivity × Familiarity:  $F(1, 2086) =  11.30, p = <.001$

  - Sensitivity × Familiarity × Accuracy: - $F(1, 1386) = 18.79, p <.001$

## Post-hoc Tests for Significant Effects: MAIN EFFECTS

### Sensitivity (Main Effect)
####  Cohen's d for Sensitivity (Main Effect)

```{r}
pairs <- emmeans(anova_model_1, pairwise ~ Sensitivity, adjust = "bonferroni", pbkrtest.limit = 6480)
(pairs_df <- as.data.frame(pairs$contrasts))
cohensd <- as.data.frame(cohens_d(value ~ Sensitivity, data = erpdat_1))
(sensitivity_contrasts_df <- bind_cols(pairs_df,cohensd))
(sensitivity_means_1 <- as.data.frame(pairs$emmeans))
```


#### Mixed Model Comparison: Sensitivity

To test the effect of `Sensitivity`, we compare:

 - Full model (anova_model_1) → includes `Sensitivity` and all interactions.
 
 - Reduced model (reduced_model) → removes `Sensitivity` and all interactions involving `Sensitivity`


```{r}
reduced_model <- update(anova_model_1,
                        . ~ . - Sensitivity - Sensitivity:Familiarity - Sensitivity:Accuracy - Sensitivity:Familiarity:Accuracy)
anova(anova_model_1, reduced_model)
```

A model including Sensitivity and its interactions provided a significantly better fit than a model without it, $\chi^2(4) = 24.88$, $p < .001$, indicating that individual differences in sensitivity modulate the ERP responses.

#### Plot for Sensitivity

Sensitivity

```{r, echo = FALSE}
sens.plot.1 <- ggplot(sensitivity_means_1, aes(x = Sensitivity, y = emmean, fill = Sensitivity, colour = Sensitivity)) +
  geom_bar(stat = "identity", position = position_dodge(), alpha = .4) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                width = 0.05, position = position_dodge(0.9)) +
  ylab("Mean ERP Amplitude (microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)), colour = "black", size = 2.5, vjust =  -7,
            position = position_dodge(.9)) +
  scale_color_custom() +
  scale_fill_custom()
# sens.plot.1
```

### Familiarity (Main Effect)
####  Cohen's d for Familiarity (Main Effect)

```{r}
pairs <- emmeans(anova_model_1, pairwise ~ Familiarity, adjust = "bonferroni", pbkrtest.limit = 6480)
(pairs_df <- as.data.frame(pairs$contrasts))
cohensd <- as.data.frame(cohens_d(value ~ Familiarity, data = erpdat_1))
(familiarity_contrasts_df <- bind_cols(pairs_df,cohensd))
(familiarity_means_1 <- as.data.frame(pairs$emmeans))

```

#### Mixed Model Comparison: Familiarity

To test the effect of `Familiarity`, we compare:

 - Full model (anova_model_1) → includes `Familiarity` and all interactions.
 
 - Reduced model (reduced_model) → removes `Familiarity` and all interactions involving `Familiarity`


```{r}
reduced_model <- update(anova_model_1,
                        . ~ . - Familiarity - Sensitivity:Familiarity - Familiarity:Accuracy - Sensitivity:Familiarity:Accuracy)
anova(anova_model_1, reduced_model)
```

Including `Familiarity` and its interactions with `Sensitivity` and `Accuracy` significantly improved model fit compared to a model without `Familiarity`, $\chi^2(4) = 258.5$, $p < .001$. This suggests that familiarity plays a key role in modulating ERP responses, beyond the effects of accuracy and individual sensitivity alone.

#### Plot for Familiarity

Familiarity

```{r, echo = FALSE}
fam.plot.1 <- ggplot(familiarity_means_1, aes(x = Familiarity, y = emmean, fill = Familiarity, colour = Familiarity)) +
  geom_bar(stat = "identity", position = position_dodge(), alpha = .4) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                width = 0.05, position = position_dodge(0.9)) +
  ylab("Mean ERP Amplitude (microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)), colour = "black", size = 2.5, vjust =  -7,
            position = position_dodge(.9)) +
  scale_color_custom() +
  scale_fill_custom()
# fam.plot.1
```


### Accuracy (Main Effect)
####  Cohen's d for Accuracy (Main Effect)

```{r}
pairs <- emmeans(anova_model_1, pairwise ~ Accuracy, adjust = "bonferroni", pbkrtest.limit = 6480)
(pairs_df <- as.data.frame(pairs$contrasts))
cohensd <- as.data.frame(cohens_d(value ~ Accuracy, data = erpdat_1))
(accuracy_contrasts_df <- bind_cols(pairs_df,cohensd))
(accuracy_means_1 <- as.data.frame(pairs$emmeans))

```

#### Mixed Model Comparison: Accuracy

To test the effect of `Accuracy`, we compare:

 - Full model (anova_model_1) → includes `Accuracy` and all interactions.
 
 - Reduced model (reduced_model) → removes `Accuracy` and all interactions involving `Accuracy`


```{r}
reduced_model <- update(anova_model_1,
                        . ~ . - Accuracy - Sensitivity:Accuracy - Familiarity:Accuracy - Sensitivity:Familiarity:Accuracy)
anova(anova_model_1, reduced_model)
```

Including Accuracy and its interactions with Sensitivity and Familiarity significantly improved model fit compared to a model without these terms, $\chi^2(4) = 15.47$, $p = .004$. This indicates that participants’ accuracy plays an important role in explaining variance in ERP responses, particularly in interaction with individual differences in sensitivity and familiarity

#### Plot for Accuracy

Accuracy

```{r, echo = FALSE}
acc.plot.1 <- ggplot(accuracy_means_1, aes(x = Accuracy, y = emmean, fill = Accuracy, colour = Accuracy)) +
  geom_bar(stat = "identity", position = position_dodge(), alpha = .4) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                width = 0.05, position = position_dodge(0.9)) +
  ylab("Mean ERP Amplitude (microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)), colour = "black", size = 2.5, vjust =  -7,
            position = position_dodge(.9)) +
  scale_color_custom() +
  scale_fill_custom()
# acc.plot.1
```


### MAIN EFFECT PLOTS

Sensitivity, Familiarity, Accuracy Main Effect Plots

```{r, fig.width=8}
library(cowplot)
plot_grid(sens.plot.1, fam.plot.1, acc.plot.1, nrow = 1)
```

## Post-hoc Tests for Significant Effects: INTERACTIONS

### Sensitivity × Familiarity (Interaction) 
#### Custom contrasts for Sensitivity × Familiarity (Interaction) 

```{r}
pairs <- emmeans(anova_model_1, pairwise ~ Sensitivity * Familiarity, adjust = "bonferroni", pbkrtest.limit = 6480)
pairs_df <- as.data.frame(pairs$contrasts)
selected_contrasts <- pairs$contrasts[pairs_df$contrast %in% c("Sensitive Familiar - Sensitive Unfamiliar",
                                                               "Sensitive Familiar - Sensitive Unfamiliar",
                                                               "Insensitive Familiar - Insensitive Unfamiliar",
                                                               "Insensitive Familiar - Insensitive Unfamiliar"), ]
selected_contrasts_df <- as.data.frame(selected_contrasts)  # Convert the emmGrid object to a dataframe
cohensd_sensitive <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_1, Sensitivity == "Sensitive")))
cohensd_insensitive <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_1, Sensitivity == "Insensitive")))

cohensd <- bind_rows(cohensd_sensitive, cohensd_insensitive)
(sensitivity.familiarity_contrasts_df <- bind_cols(selected_contrasts_df,cohensd))
(sensitivity.familiarity_means <- as.data.frame(pairs$emmeans))
```

#### Plots for Sensitivity × Familiarity (Interaction)

Plots for Sensitivity × Familiarity (Interaction)

```{r,  echo=FALSE}

p1 <- sensitivity.familiarity_means|>
  ggplot(aes(x = Sensitivity,
             y = emmean,
             fill = Familiarity,
             colour = Familiarity)) +
  geom_col(alpha = .4, position = position_dodge(.9)) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), 
                width = .15,
                position = position_dodge(.9)) +
  labs(y="Mean ERP amplitude (in microvolts)",
       x = "Sensitivity") +
  geom_text(aes(label = round(emmean, digits = 2)),
                colour = "black",size = 2.5, vjust = -1.7, position = position_dodge(.65)) +
  scale_color_custom() +
  scale_fill_custom()
p1
```



For both groups Familiar stimuli elicited significantly lower ERP amplitudes than Unfamiliar stimuli (p < .0001).
   

### Sensitivity × Familiarity × Accuracy (Interaction) 
####  Custom contrasts for Sensitivity × Familiarity × Accuracy (Interaction)


```{r}

pairs <- emmeans(anova_model_1, 
                 pairwise ~ Sensitivity * Accuracy * Familiarity, 
                 adjust = "bonferroni", 
                 pbkrtest.limit = 6480)
pairs_df <- as.data.frame(pairs$contrasts)
selected_contrasts <- pairs$contrasts[pairs_df$contrast %in% c(
  "Sensitive Correct Familiar - Sensitive Correct Unfamiliar",
  "Sensitive Incorrect Familiar - Sensitive Incorrect Unfamiliar",
  "Insensitive Correct Familiar - Insensitive Correct Unfamiliar",
  "Insensitive Incorrect Familiar - Insensitive Incorrect Unfamiliar"), ]
selected_contrasts_df <- as.data.frame(selected_contrasts)  # Convert the emmGrid object to a dataframe

cohensd_1 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_1, Sensitivity == "Sensitive" & Accuracy == "Correct")))
cohensd <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_1, Sensitivity == "Insensitive" & Accuracy == "Correct")))
cohensd_3 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_1, Sensitivity == "Sensitive" & Accuracy == "Incorrect")))
cohensd_4 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_1, Sensitivity == "Insensitive" & Accuracy == "Incorrect")))

cohensd <- bind_rows(cohensd_1, cohensd, cohensd_3, cohensd_4)
(sensitivity.familiarity.accuracy_contrasts <- bind_cols(selected_contrasts_df,cohensd))
(sensitivity.familiarity.accuracy_means_1 <- as.data.frame(pairs$emmeans))

```

#### Plots for Sensitivity × Familiarity × Accuracy (Interaction)

Plots for Sensitivity × Familiarity × Accuracy (Interaction)


```{r, echo=FALSE, fig.width=7}
p2 <- sensitivity.familiarity.accuracy_means_1 |> 
  ggplot(aes(x = Accuracy,
             y = emmean,
             fill = Familiarity,
             colour = Familiarity)) +
  facet_grid(. ~ Sensitivity) + 
  geom_col(position=position_dodge(), alpha = .4)+
  coord_cartesian(ylim = c(-4.5, 1.5)) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                position = position_dodge(0.9),  
                width = 0.15) +                    
  labs(y = "Mean ERP amplitude (in microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)), colour = "black", size = 2.5,  
            vjust = -1, position = position_dodge(.45))  +
  scale_color_custom() +
  scale_fill_custom() 
p2
```





---
# ANOVA Group 2

## ANOVA Model
```{r}
# Group 2

# Run the Mixed ANOVA
anova_model_2 <- mixed(
  value ~ Sensitivity * Familiarity * Accuracy + 
    Laterality * Anteriority +  # Nuisance variables
    (1 | SubjID), 
  data = erpdat_2, 
  method = "KR"  # Kenward-Roger approximation for accurate F-tests
)

# Print ANOVA results
anova_model_2

```

Compute Partial Eta Squared ($\eta_p^2$ ) for F-tests. This gives $\eta_p^2$  values for each effect.  Then, compute $R^2$ for the Mixed Model. This provides marginal $R^2$ (fixed effects only) and conditional $R^2$ (fixed + random effects).

```{r}
# Extract effect sizes from your ANOVA model
library(effectsize)
eta_squared(anova_model_2, partial = TRUE)

# Compute Marginal and Conditional R²
library(performance)
r2(anova_model_2)
```

### Main Findings: ANOVA

**Main Effects**
	
  - Familiarity (within-subjects):   $F(1, 1386) = 22.98, p <.001$

**Interactions**
	
  - Sensitivity × Familiarity:  $F(1, 1386) =  42.17, p = <.001$
  
  - Familiarity × Accuracy:     $F(1, 1386) =   7.52, p =  .006$


## Post-hoc Tests for Significant Effects: MAIN EFFECTS
### Familiarity (Main Effect)

####  Cohen's d for Familiarity (Main Effect)

```{r}
pairs <- emmeans(anova_model_2, pairwise ~ Familiarity, adjust = "bonferroni", pbkrtest.limit = 6480)
(pairs_df <- as.data.frame(pairs$contrasts))
cohensd <- as.data.frame(cohens_d(value ~ Familiarity, data = erpdat_2))
(familiarity_contrasts_df <- bind_cols(pairs_df,cohensd))
(familiarity_means_2 <- as.data.frame(pairs$emmeans))
```


#### Mixed Model Comparison: Familiarity

To test the effect of Familiarity, we compare:

 - Full model (anova_model_2) → includes Familiarity and all interactions.
 - Reduced model (reduced_model) → removes Familiarity and all interactions involving Familiarity


```{r}
reduced_model <- update(anova_model_2,
                        . ~ . - Familiarity - Sensitivity:Familiarity - Familiarity:Accuracy - Sensitivity:Familiarity:Accuracy)
anova(anova_model_2, reduced_model)
```

Including `Familiarity` and its interactions with `Sensitivity` and `Accuracy` significantly improved model fit compared to a model without these terms, $\chi^2(4) = 106.04$, $p < .001$. This indicates that familiarity plays a critical role in predicting ERP amplitude, particularly in interaction with individual differences in sensitivity and response accuracy.


#### Plot for Familiarity

Familiarity

```{r, echo = FALSE, fig.height=3.5, fig.width=3.5}
fam.plot.2 <- ggplot(familiarity_means_2, aes(x = Familiarity, y = emmean, fill = Familiarity, colour = Familiarity)) +
  geom_bar(stat = "identity", position = position_dodge(), alpha = .4) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                width = 0.05, position = position_dodge(0.9)) +
  ylab("Mean ERP Amplitude (microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)), colour = "black", size = 3, vjust =  -7,
            position = position_dodge(.9)) +
  scale_color_custom() +
  scale_fill_custom()
fam.plot.1
```


## Post-hoc Tests for Significant Effects:INTERACTIONS
### Sensitivity × Familiarity (Interaction) 
#### Custom contrasts  for Sensitivity × Familiarity (Interaction)

To explore the `Sensitivity x Familiarity ` Interaction for Cohort 2, I examined the following contrasts:

  `Sensitive  Familiar - Sensitive Correct Unfamiliar`
  
  `Sensitive  Familiar - Sensitive Incorrect Unfamiliar` 


```{r}
pairs_2 <- emmeans(anova_model_2, pairwise ~ Sensitivity * Familiarity, adjust = "bonferroni", pbkrtest.limit = 6480)
pairs_df_2 <- as.data.frame(pairs_2$contrasts)
selected_contrasts_2 <- pairs_2$contrasts[pairs_df_2$contrast %in% c("Sensitive Familiar - Sensitive Unfamiliar",
                                                               "Insensitive Familiar - Insensitive Unfamiliar"), ]
selected_contrasts_df_2 <- as.data.frame(selected_contrasts_2)  # Convert the emmGrid object to a dataframe
cohensd_sensitive_2 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_2, Sensitivity == "Sensitive")))
cohensd_insensitive_2 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_2, Sensitivity == "Insensitive")))
cohensd_2 <- bind_rows(cohensd_sensitive_2, cohensd_insensitive_2)
(sensitivity.familiarity_contrasts_df_2 <- bind_cols(selected_contrasts_df_2,cohensd_2))
(sensitivity.familiarity_means_2 <- as.data.frame(pairs_2$emmeans))
```

#### Plots for Sensitivity × Familiarity (Interaction)

Plots for Sensitivity × Familiarity (Interaction)

```{r,  echo=FALSE}


p3 <- sensitivity.familiarity_means_2|>
  ggplot(aes(x = Sensitivity,y = emmean,fill = Familiarity,colour = Familiarity)) +
  geom_col(alpha = .4, position = position_dodge(.9)) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), 
                width = .15,
                position = position_dodge(.9)) +
  labs(y="Voltage (microvolts)",
       x = "Sensitivity") +
  geom_text(aes(label = round(emmean, digits = 2)),
                colour = "black",size = 2.5, vjust = -1.7, position = position_dodge(.5)) +
  scale_color_custom() +
  scale_fill_custom()
# p3

```



### Familiarity × Accuracy (Interaction) 
####  Custom contrasts for Familiarity × Accuracy (Interaction)

To explore the `Familiarity` x `Accuracy` Interaction for Cohort 2, I examined the following contrasts: (1)  `Correct Familiar - Correct Unfamiliar`. (2) Incorrect Familiar - Incorrect Unfamiliar` 

```{r}
pairs_2 <- emmeans(anova_model_2, pairwise ~ Accuracy * Familiarity, adjust = "bonferroni",  pbkrtest.limit = 6480)
pairs_df_2 <- as.data.frame(pairs_2$contrasts)
selected_contrasts_2 <- pairs_2$contrasts[pairs_df_2$contrast %in% c("Correct Familiar - Correct Unfamiliar",
                                                                     "Incorrect Familiar - Incorrect Unfamiliar"), ]
selected_contrasts_df_2 <- as.data.frame(selected_contrasts_2)  # Convert the emmGrid object to a dataframe

cohensd_1 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_2, Accuracy == "Correct")))
cohensd_2 <- as.data.frame(cohens_d(value ~ Familiarity, 
         data = subset(erpdat_2, Accuracy == "Incorrect")))

cohensd <- bind_rows(cohensd_1, cohensd_2)
(familiarity.accuracy_contrasts_2 <- bind_cols(selected_contrasts_df_2,cohensd))
(familiarity.accuracy_means_2 <- as.data.frame(pairs_2$emmeans))
```

#### Plots for Familiarity × Accuracy (Interaction)


```{r, echo=FALSE}
p4 <- familiarity.accuracy_means_2 |> 
  ggplot(aes(x = Accuracy,
             y = emmean,
             fill = Familiarity,
             colour = Familiarity)) +
  geom_col(position=position_dodge(), alpha = .4)+
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                position = position_dodge(0.9),  
                width = 0.15) +                    
  labs(x = "Accuracy", y = "Mean ERP amplitude (in microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)),
            colour = "black", size = 2.5, vjust = -1.8, position = position_dodge(.6))  +
  scale_color_custom() +
  scale_fill_custom()
# p4
```


### Two way interaction Plots

A. Plot for Sensitivity × Familiarity (Interaction)

B. Plots for Familiarity × Accuracy (Interaction)

```{r, fig.height = 3.5, fig.width=8}
library(cowplot)
plot_grid(p3, p4,  nrow = 1)
```




### Sensitivity × Familiarity × Accuracy (Interaction) NOT SIGNIFICANT
####  Custom contrasts for Sensitivity × Familiarity × Accuracy (Interaction)


```{r}

pairs_2 <- emmeans(anova_model_2, 
                 pairwise ~ Sensitivity * Accuracy * Familiarity, 
                 adjust = "bonferroni", 
                 pbkrtest.limit = 6480)

(sensitivity.familiarity.accuracy_means_2 <- as.data.frame(pairs_2$emmeans))

```

#### Plots for Sensitivity × Familiarity × Accuracy (Interaction)

Plots for Sensitivity × Familiarity × Accuracy (Interaction)


```{r, echo=FALSE, fig.width=7}
p5 <- sensitivity.familiarity.accuracy_means_2 |> 
  ggplot(aes(x = Accuracy,
             y = emmean,
             fill = Familiarity,
             colour = Familiarity)) +
  facet_grid(. ~ Sensitivity) + 
  geom_col(position=position_dodge(), alpha = .4)+
  coord_cartesian(ylim = c(-4.5, 1.5)) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE),
                position = position_dodge(0.9),  
                width = 0.15) +                    
  labs(y = "Mean ERP amplitude (in microvolts)") +
  geom_text(aes(label = round(emmean, digits = 2)), colour = "black", size = 2.5,  
            vjust = -1.0, position = position_dodge(.5))  +
  scale_color_custom() +
  scale_fill_custom()
p5
```




